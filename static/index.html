<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>/tmp/files - Temporary Image Upload</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background-color: #f9fafb;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">/tmp/files</h1>
        <h2 class="text-gray-500 mb-6">Temporary Image Hosting</h2>
        <p class="text-sm text-gray-500 mb-4">Only image files (PNG, JPG, JPEG, GIF, WEBP) are accepted.<br>
            All uploaded images are automatically deleted after 60 minutes.</p>

        <form id="uploadForm" enctype="multipart/form-data" class="space-y-4">
            <input type="file" name="file" id="fileInput" required
                accept="image/png,image/jpeg,image/jpg,image/gif,image/webp"
                class="w-full text-gray-700 border border-gray-300 rounded-md p-2">
            <button type="submit"
                class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-md hover:bg-blue-700 transition">
                Upload Image
            </button>
        </form>

        <div id="result" class="mt-6 text-sm text-gray-700"></div>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                Swal.fire('No File', 'Please select an image to upload.', 'warning');
                return;
            }

            // Validasi ukuran file (50MB)
            if (file.size > 50 * 1024 * 1024) {
                Swal.fire('Too Large', 'Maximum file size is 50MB.', 'error');
                return;
            }

            // Validasi tipe file
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                Swal.fire('Invalid File Type', 'Only image files (PNG, JPG, JPEG, GIF, WEBP) are allowed.', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            Swal.fire({
                title: 'Uploading...',
                text: 'Please wait while your image is being uploaded.',
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading()
            });

            try {
                const res = await fetch('/upload', { method: 'POST', body: formData });
                const data = await res.json();

                Swal.close();

                if (data.success) {
                    const html = `
                        <div class="space-y-3">
                            <p>âœ… <strong>${data.filename}</strong></p>
                            <p>Expires at: <code>${data.expires}</code></p>
                            <a href="${data.url}" target="_blank" class="text-blue-600 hover:underline">${data.url}</a>
                            <div class="mt-3">
                                <img src="${data.url}" alt="Uploaded Image" class="max-h-60 mx-auto rounded-md shadow">
                            </div>
                        </div>
                    `;
                    document.getElementById('result').innerHTML = html;

                    document.getElementById('uploadForm').reset();

                    Swal.fire('Upload Successful', 'Your image has been uploaded!', 'success');
                } else {
                    Swal.fire('Upload Failed', 'The server could not process your file.', 'error');
                }
            } catch (err) {
                Swal.close();
                Swal.fire('Error', 'An error occurred during upload.', 'error');
                console.error(err);
            }
        });
    </script>
</body>

</html>